{
  "info": {
    "name": "ChangeWorks Subscription APIs",
    "description": "Complete collection of Stripe subscription payment APIs for ChangeWorks platform",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3002",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Subscription Management",
      "item": [
        {
          "name": "List All Subscriptions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions"]
            }
          }
        },
        {
          "name": "List Subscriptions with Pagination",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions?page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "List Subscriptions by Donor ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions?donor_id=58",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions"],
              "query": [
                {
                  "key": "donor_id",
                  "value": "58"
                }
              ]
            }
          }
        },
        {
          "name": "List Subscriptions by Organization ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions?organization_id=17",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions"],
              "query": [
                {
                  "key": "organization_id",
                  "value": "17"
                }
              ]
            }
          }
        },
        {
          "name": "List Subscriptions by Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions?status=ACTIVE",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions"],
              "query": [
                {
                  "key": "status",
                  "value": "ACTIVE"
                }
              ]
            }
          }
        },
        {
          "name": "Get Subscription by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/1",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "1"]
            }
          }
        },
        {
          "name": "Check Customer Subscription (by donor_id)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/check-customer?donor_id=58",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "check-customer"],
              "query": [
                {
                  "key": "donor_id",
                  "value": "58"
                }
              ]
            }
          }
        },
        {
          "name": "Check Customer Subscription (by email)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/check-customer?customer_email=test@example.com",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "check-customer"],
              "query": [
                {
                  "key": "customer_email",
                  "value": "test@example.com"
                }
              ]
            }
          }
        },
        {
          "name": "Check Customer Subscription (with organization)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/check-customer?donor_id=58&organization_id=17",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "check-customer"],
              "query": [
                {
                  "key": "donor_id",
                  "value": "58"
                },
                {
                  "key": "organization_id",
                  "value": "17"
                }
              ]
            }
          }
        },
        {
          "name": "Check Customer Subscription (include inactive)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/check-customer?donor_id=58&include_inactive=true",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "check-customer"],
              "query": [
                {
                  "key": "donor_id",
                  "value": "58"
                },
                {
                  "key": "include_inactive",
                  "value": "true"
                }
              ]
            }
          }
        },
        {
          "name": "Check Multiple Customer Subscriptions",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customers\": [\n    {\n      \"donor_id\": 58\n    },\n    {\n      \"customer_email\": \"test@example.com\"\n    },\n    {\n      \"donor_id\": 59,\n      \"customer_email\": \"another@example.com\"\n    }\n  ],\n  \"organization_id\": 17,\n  \"include_inactive\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/check-customer",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "check-customer"]
            }
          }
        },
        {
          "name": "Create Subscription (Direct)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"donor_id\": 58,\n  \"organization_id\": 17,\n  \"package_id\": 2,\n  \"payment_method_id\": \"pm_card_visa\",\n  \"customer_email\": \"test@example.com\",\n  \"customer_name\": \"Test User\",\n  \"trial_period_days\": 7\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions"]
            }
          }
        },
        {
          "name": "Update Subscription",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"update_payment_method\",\n  \"payment_method_id\": \"pm_new1234567890\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/1",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "1"]
            }
          }
        },
        {
          "name": "Cancel Subscription",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/1?immediate=false",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "1"],
              "query": [
                {
                  "key": "immediate",
                  "value": "false"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Payment Setup",
      "item": [
        {
          "name": "Setup Payment for Subscription",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"donor_id\": 58,\n  \"organization_id\": 17,\n  \"package_id\": 2,\n  \"customer_email\": \"test@example.com\",\n  \"customer_name\": \"Test User\",\n  \"return_url\": \"http://localhost:3002/subscription/success\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/setup-payment",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "setup-payment"]
            }
          }
        }
      ]
    },
    {
      "name": "Subscription Transactions",
      "item": [
        {
          "name": "Get Subscription Transactions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/1/transactions",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "1", "transactions"]
            }
          }
        },
        {
          "name": "Get Subscription Invoices",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/1/invoices",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "1", "invoices"]
            }
          }
        }
      ]
    },
    {
      "name": "Payment Methods",
      "item": [
        {
          "name": "List Payment Methods",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/payment-methods?donor_id=58",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "payment-methods"],
              "query": [
                {
                  "key": "donor_id",
                  "value": "58"
                }
              ]
            }
          }
        },
        {
          "name": "Add Payment Method",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"donor_id\": 58,\n  \"organization_id\": 17,\n  \"payment_method_id\": \"pm_1234567890abcdef\",\n  \"set_as_default\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/payment-methods",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "payment-methods"]
            }
          }
        },
        {
          "name": "Remove Payment Method",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/payment-methods?payment_method_id=pm_1234567890abcdef",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "payment-methods"],
              "query": [
                {
                  "key": "payment_method_id",
                  "value": "pm_1234567890abcdef"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Billing",
      "item": [
        {
          "name": "Get Billing Information",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/billing?subscription_id=1",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "billing"],
              "query": [
                {
                  "key": "subscription_id",
                  "value": "1"
                }
              ]
            }
          }
        },
        {
          "name": "Update Billing Information",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subscription_id\": 1,\n  \"payment_method_id\": \"pm_1234567890abcdef\",\n  \"billing_cycle_anchor\": \"2025-02-01T00:00:00.000Z\",\n  \"proration_behavior\": \"create_prorations\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/billing",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "billing"]
            }
          }
        }
      ]
    },
    {
      "name": "Payments",
      "item": [
        {
          "name": "Get Payment History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/payments?subscription_id=1",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "payments"],
              "query": [
                {
                  "key": "subscription_id",
                  "value": "1"
                }
              ]
            }
          }
        },
        {
          "name": "Create Manual Payment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subscription_id\": 1,\n  \"amount\": 29.99,\n  \"currency\": \"USD\",\n  \"payment_method_id\": \"pm_1234567890abcdef\",\n  \"description\": \"Manual payment for subscription\",\n  \"metadata\": {\n    \"reason\": \"manual_payment\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/payments",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "payments"]
            }
          }
        }
      ]
    },
    {
      "name": "Refunds",
      "item": [
        {
          "name": "Get Refund History",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/refunds?subscription_id=1",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "refunds"],
              "query": [
                {
                  "key": "subscription_id",
                  "value": "1"
                }
              ]
            }
          }
        },
        {
          "name": "Create Refund",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subscription_id\": 1,\n  \"transaction_id\": 1,\n  \"amount\": 29.99,\n  \"reason\": \"requested_by_customer\",\n  \"metadata\": {\n    \"refund_reason\": \"customer_request\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/refunds",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "refunds"]
            }
          }
        }
      ]
    },
    {
      "name": "Invoices",
      "item": [
        {
          "name": "Get Invoices",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/invoices?subscription_id=1",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "invoices"],
              "query": [
                {
                  "key": "subscription_id",
                  "value": "1"
                }
              ]
            }
          }
        },
        {
          "name": "Create Manual Invoice",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"subscription_id\": 1,\n  \"amount\": 29.99,\n  \"currency\": \"USD\",\n  \"description\": \"Manual invoice for subscription\",\n  \"due_date\": \"2025-02-01T00:00:00.000Z\",\n  \"metadata\": {\n    \"reason\": \"manual_invoice\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/subscriptions/invoices",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "invoices"]
            }
          }
        }
      ]
    },
    {
      "name": "Analytics",
      "item": [
        {
          "name": "Get Subscription Analytics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/subscriptions/analytics?organization_id=17&period=30",
              "host": ["{{base_url}}"],
              "path": ["api", "subscriptions", "analytics"],
              "query": [
                {
                  "key": "organization_id",
                  "value": "17"
                },
                {
                  "key": "period",
                  "value": "30"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Packages",
      "item": [
        {
          "name": "List Packages",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/packages",
              "host": ["{{base_url}}"],
              "path": ["api", "packages"]
            }
          }
        },
        {
          "name": "Create Package",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Premium Plan\",\n  \"description\": \"Premium subscription plan with advanced features\",\n  \"price\": 49.99,\n  \"currency\": \"USD\",\n  \"duration\": 30,\n  \"features\": \"Advanced features, priority support, custom integrations\",\n  \"category\": \"premium\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/packages",
              "host": ["{{base_url}}"],
              "path": ["api", "packages"]
            }
          }
        },
        {
          "name": "Get Package by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/packages/1",
              "host": ["{{base_url}}"],
              "path": ["api", "packages", "1"]
            }
          }
        }
      ]
    },
    {
      "name": "Donors",
      "item": [
        {
          "name": "List Donors",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/donor",
              "host": ["{{base_url}}"],
              "path": ["api", "donor"]
            }
          }
        },
        {
          "name": "Create Donor",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Donor\",\n  \"email\": \"testdonor@example.com\",\n  \"phone\": \"+1234567890\",\n  \"password\": \"testpassword123\",\n  \"organization_id\": 17\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/donor",
              "host": ["{{base_url}}"],
              "path": ["api", "donor"]
            }
          }
        }
      ]
    },
    {
      "name": "Stripe Products & Prices",
      "item": [
        {
          "name": "Get All Stripe Products",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/stripe/products",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "products"]
            }
          }
        },
        {
          "name": "Get Active Stripe Products",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/stripe/products?active=true",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "products"],
              "query": [
                {
                  "key": "active",
                  "value": "true"
                }
              ]
            }
          }
        },
        {
          "name": "Create Stripe Product",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Premium Subscription Plan\",\n  \"description\": \"Premium subscription with advanced features\",\n  \"active\": true,\n  \"metadata\": {\n    \"category\": \"subscription\",\n    \"tier\": \"premium\"\n  },\n  \"type\": \"service\",\n  \"unit_label\": \"month\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/stripe/products",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "products"]
            }
          }
        },
        {
          "name": "Get All Stripe Prices",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/stripe/prices",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "prices"]
            }
          }
        },
        {
          "name": "Get Recurring Prices",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/stripe/prices?type=recurring",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "prices"],
              "query": [
                {
                  "key": "type",
                  "value": "recurring"
                }
              ]
            }
          }
        },
        {
          "name": "Get Prices by Product",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/stripe/prices?product=prod_1234567890",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "prices"],
              "query": [
                {
                  "key": "product",
                  "value": "prod_1234567890"
                }
              ]
            }
          }
        },
        {
          "name": "Create Recurring Price",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product\": \"prod_1234567890\",\n  \"unit_amount\": 2999,\n  \"currency\": \"usd\",\n  \"recurring\": {\n    \"interval\": \"month\",\n    \"interval_count\": 1\n  },\n  \"nickname\": \"Monthly Premium\",\n  \"metadata\": {\n    \"type\": \"subscription\",\n    \"billing_cycle\": \"monthly\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/stripe/prices",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "prices"]
            }
          }
        },
        {
          "name": "Create One-time Price",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"product\": \"prod_1234567890\",\n  \"unit_amount\": 999,\n  \"currency\": \"usd\",\n  \"nickname\": \"One-time Premium\",\n  \"metadata\": {\n    \"type\": \"one_time\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/stripe/prices",
              "host": ["{{base_url}}"],
              "path": ["api", "stripe", "prices"]
            }
          }
        }
      ]
    },
    {
      "name": "Testing & Debug",
      "item": [
        {
          "name": "Test Stripe Connection",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/payments/test",
              "host": ["{{base_url}}"],
              "path": ["api", "payments", "test"]
            }
          }
        },
        {
          "name": "Check Environment Variables",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/debug/env-check",
              "host": ["{{base_url}}"],
              "path": ["api", "debug", "env-check"]
            }
          }
        },
        {
          "name": "Check Stripe Transactions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/check-stripe-transactions",
              "host": ["{{base_url}}"],
              "path": ["api", "check-stripe-transactions"]
            }
          }
        }
      ]
    }
  ]
}
